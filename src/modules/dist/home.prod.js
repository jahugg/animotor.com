"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.render=render;var _=_interopRequireDefault(require("./../media/animation/*.*")),helpers=_interopRequireWildcard(require("./helpers.js"));function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var n,r={},i=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e){Object.prototype.hasOwnProperty.call(e,a)&&((n=i?Object.getOwnPropertyDescriptor(e,a):null)&&(n.get||n.set)?Object.defineProperty(r,a,n):r[a]=e[a])}return r.default=e,t&&t.set(e,r),r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function render(){var r,i,a,o,n=0,l=!1,c=document.createElement("div");c.classList.add("infinite-scroll-container"),c.innerHTML="loading",main.appendChild(c);var e=[];for(var t in _.default)for(var u in _.default[t])e.push(helpers.loadImage(_.default[t][u]));function d(e){e.preventDefault();var t=e.changedTouches;r=t[0].pageY,cancelAnimationFrame(a),cancelAnimationFrame(o)}function s(e){e.preventDefault(),i=r;var t=e.changedTouches,n=-1*(r-t[0].pageY);r=t[0].pageY,h(O()+n),p(n)}function f(e){e.preventDefault();var t=e.changedTouches,r=-1*(i-t[0].pageY);a=window.requestAnimationFrame(function e(t){var n=!!document.querySelector(".infinite-scroll");{n&&(r=Math.min(Math.max(r,-80),80),h(O()+r),p(r),r<.25?(r+=.25,a=window.requestAnimationFrame(e)):.25<r?(r-=.25,a=window.requestAnimationFrame(e)):(r=0,cancelAnimationFrame(a)))}})}function m(e){e.preventDefault();var t=-1*e.deltaY;h(O()+t),p(t),l=Math.abs(n)<=Math.abs(t)&&!l,n=t,150<Math.abs(t)&&0,cancelAnimationFrame(a),cancelAnimationFrame(o)}function p(e){var t=Math.abs(e),t=Math.min(Math.max(t,0),80),n=helpers.map(t,0,80,1,.1),r=helpers.map(t,20,80,0,1),i=document.querySelector(".static-anim"),a=document.querySelector(".infinite-scroll");i.style.opacity=r,a.style.opacity=n}function O(){var e,t=document.querySelector(".infinite-scroll"),n=window.getComputedStyle(t).getPropertyValue("transform");return"none"===n?(t.style.transform="translateY(0)",0):(e=n.match(/matrix.*\((.+)\)/)[1].split(", "),parseInt(e[5],10))}function h(e){document.querySelector(".infinite-scroll").style.transform="translateY("+e+"px)"}function j(){var e=0,t=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var r,i=Object.keys(_.default);t.hasChildNodes()&&(e=(r=parseInt(t.lastChild.getAttribute("data-id"),10))===i.length-1?0:r+1);var a="Untitled_Artwork-"+(e+1).toString();n.innerHTML='<img src="'+_.default[a].png+'">',n.setAttribute("data-id",e),t.appendChild(n)}Promise.all(e).then(function(e){c.innerHTML="";var t=document.createElement("div");t.classList.add("infinite-scroll-mask"),c.appendChild(t);var n=Object.keys(_.default),r=document.createElement("div");r.classList.add("static-anim"),c.appendChild(r);var i=document.createElement("img");i.src=_.default[n[0]].png,i.setAttribute("data-id",0),r.appendChild(i);var a=document.createElement("div");a.classList.add("infinite-scroll"),c.appendChild(a);var L=c.getBoundingClientRect();for(;a.scrollHeight<=L.height;)j();o=window.requestAnimationFrame(function e(){document.querySelector(".infinite-scroll")&&(h(O()+1),o=window.requestAnimationFrame(e))}),c.addEventListener("wheel",helpers.throttledEvent(m,5)),c.addEventListener("touchstart",d,!1),c.addEventListener("touchmove",helpers.throttledEvent(s,5),!1),c.addEventListener("touchend",f,!1),c.addEventListener("touchcancel",f,!1),new MutationObserver(function(e){var t=!0,n=!1,r=void 0;try{for(var i,a=e[Symbol.iterator]();!(t=(i=a.next()).done);t=!0){var o=i.value;if("attributes"===o.type&&"style"===o.attributeName){var l=document.querySelector(".infinite-scroll"),c=O(),u=l.firstChild,d=l.lastChild;Math.abs(c)>u.offsetHeight?(u.remove(),l.style.transform="translateY(0)"):l.offsetHeight-d.offsetHeight-Math.abs(c)>L.height&&d.remove(),0<c?function(){var e=0,t=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var r=Object.keys(_.default),i=parseInt(t.firstChild.getAttribute("data-id"),10);e=0===i?r.length-1:i-1;var a="Untitled_Artwork-"+(e+1).toString();n.innerHTML='<img src="'+_.default[a].png+'">',n.setAttribute("data-id",e),t.prepend(n),t.style.transform="translateY("+-n.offsetHeight+"px)"}():L.height+Math.abs(c)>l.offsetHeight&&j();var s,f,m,p=document.getElementsByClassName("infinite-scroll__item"),h=document.querySelector(".static-anim"),y=h.getBoundingClientRect(),v=void 0,g=9999,b=!0,q=!1,w=void 0;try{for(var M,S=p[Symbol.iterator]();!(b=(M=S.next()).done);b=!0){var C=M.value,A=C.getBoundingClientRect(),E=Math.abs(A.top-y.top);E<g&&(g=E,v=C)}}catch(e){q=!0,w=e}finally{try{b||null==S.return||S.return()}finally{if(q)throw w}}v.getBoundingClientRect().top<=y.top&&(s=Object.keys(_.default),f=h.querySelector("img"),m=v.getAttribute("data-id"),f.src=_.default[s[m]].png,f.setAttribute("data-id",m))}}}catch(e){n=!0,r=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw r}}}).observe(a,{attributes:!0})}).catch(function(e){return console.error(e)})}