"use strict";require("./fonts.less"),require("./styles.less");var _=_interopRequireDefault(require("./media/*/*.*")),_2=_interopRequireDefault(require("./animation/*.*")),_contentInfo=_interopRequireDefault(require("./content-info.md"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _getRequireWildcardCache(){if("function"!=typeof WeakMap)return null;var e=new WeakMap;return _getRequireWildcardCache=function(){return e},e}function _interopRequireWildcard(e){if(e&&e.__esModule)return e;if(null===e||"object"!==_typeof(e)&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache();if(t&&t.has(e))return t.get(e);var n,i={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in e){Object.prototype.hasOwnProperty.call(e,r)&&((n=a?Object.getOwnPropertyDescriptor(e,r):null)&&(n.get||n.set)?Object.defineProperty(i,r,n):i[r]=e[r])}return i.default=e,t&&t.set(e,i),i}var pages={home:{title:"â—‹",slug:"/",module:"home.js",loadContents:function(){loadHome()}},work:{title:"Work",slug:"/work",module:"work.js",loadContents:function(){loadWork()}},info:{title:"Info",slug:"/info",module:"info.js",loadContents:function(){loadInfo()}}},defaultPage=pages.home;function initApp(){buildNavigation(),navigateToCurrentURL(),window.addEventListener("popstate",function(e){buildPage({slug:e.state.slug},!1)})}function navigateToCurrentURL(){var e=window.location.pathname,t=defaultPage;for(var n in pages)pages[n].slug===e&&(t=pages[n]);buildPage({slug:t.slug},!0)}function buildNavigation(){var e=document.getElementById("app"),t=document.createElement("nav");t.id="nav",e.appendChild(t);var n=document.createElement("ul");for(var i in t.appendChild(n),pages){var a=document.createElement("li"),r=document.createElement("a");r.href=pages[i].slug,r.setAttribute("data-link",""),r.innerHTML=pages[i].title,a.appendChild(r),n.appendChild(a),r.addEventListener("click",handlePageLink)}}function buildPage(e,t){var n,i=document.getElementById("main");for(var a in i?i.innerHTML="":((i=document.createElement("main")).id="main",app.appendChild(i)),pages)pages[a].slug===e.slug&&(n=pages[a]);var r="Animotor";n!==defaultPage&&(r+=" - "+n.title),document.title=r,t&&window.history.pushState(e,n.title,n.slug),updateNavigation(n.slug),Promise.resolve().then(function(){return _interopRequireWildcard(require("./pages/work.js"))}).then(function(e){e.render()}).catch(function(e){console.log(e.message)})}function updateNavigation(e){var t=document.querySelectorAll("nav a"),n=!0,i=!1,a=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){r.value.removeAttribute("data-active")}}catch(e){i=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}document.querySelector('a[href="'+e+'"]').setAttribute("data-active","")}function handlePageLink(e){e.preventDefault(),buildPage({slug:e.target.getAttribute("href")},!0)}function loadInfo(){document.getElementById("main").innerHTML='<article class="info">'+_contentInfo.default+"</article>"}function loadWork(){var e=document.getElementById("main"),v=document.createElement("div");v.classList.add("slideshow-container"),e.appendChild(v);function t(e){var t=1<Object.keys(_.default[e]).length,n=document.createElement("div");n.classList.add("slideshow"),v.appendChild(n);var i=document.createElement("div");i.classList.add("slideshow__slides-wrapper"),n.appendChild(i);var a=void 0;i.addEventListener("scroll",function(t){window.clearTimeout(a),a=setTimeout(function(){var e=Math.round(t.target.scrollLeft/t.target.offsetWidth);!function(e){var t=e.parentNode,n=!0,i=!1,a=void 0;try{for(var r,o=t.children[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){r.value.removeAttribute("data-active")}}catch(e){i=!0,a=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw a}}e.setAttribute("data-active","")}(t.target.closest(".slideshow").querySelector(".slideshow__indicators-wrapper").children[e])},10)},!1);var r,o,l,d=void 0;for(var s in t&&((r=document.createElement("div")).classList.add("slideshow__nav"),n.appendChild(r),(o=document.createElement("button")).classList.add("slideshow__nav__btn"),r.appendChild(o),o.addEventListener("click",g),(l=document.createElement("button")).classList.add("slideshow__nav__btn"),r.appendChild(l),l.addEventListener("click",y),(d=document.createElement("div")).classList.add("slideshow__indicators-wrapper"),n.appendChild(d)),_.default[e])for(var c in _.default[e][s]){var u,f,m=_.default[e][s][c],p=document.createElement("div");p.classList.add("slideshow__slide"),i.appendChild(p),"jpg"!==c&&"png"!==c&&"gif"!==c||((u=document.createElement("img")).src=m,u.classList.add("slideshow__slide__media"),p.appendChild(u)),t&&((f=document.createElement("div")).classList.add("slideshow__indicator"),f.addEventListener("click",h),d.appendChild(f))}t&&d.querySelector(".slideshow__indicator").setAttribute("data-active","")}for(var n in _.default)t(n);function h(e){var t=e.target,n=t.closest(".slideshow__indicators-wrapper"),i=t.closest(".slideshow"),a=i.querySelector(".slideshow__slides-wrapper"),r=Array.from(n.children).indexOf(t);a.scrollTo({left:r*i.offsetWidth,behavior:"smooth"})}function g(e){var t=e.target.closest(".slideshow__slides-wrapper");t.scrollTo({left:t.scrollLeft-t.offsetWidth,behavior:"smooth"})}function y(e){var t=e.target.closest(".slideshow__slides-wrapper");t.scrollTo({left:t.scrollLeft+t.offsetWidth,behavior:"smooth"})}}function loadHome(){var i,a,r,o,n=0,l=!1,d=document.createElement("div");d.classList.add("infinite-scroll-container"),d.innerHTML="loading",main.appendChild(d);var e=[];for(var t in _2.default)for(var s in _2.default[t])e.push(loadImage(_2.default[t][s]));function c(e){e.preventDefault();var t=e.changedTouches;i=t[0].pageY,cancelAnimationFrame(r),cancelAnimationFrame(o)}function u(e){e.preventDefault(),a=i;var t=e.changedTouches,n=-1*(i-t[0].pageY);i=t[0].pageY,v(S()+n),p(n)}function f(e){e.preventDefault();var t=e.changedTouches,i=-1*(a-t[0].pageY);r=window.requestAnimationFrame(function e(t){var n=!!document.querySelector(".infinite-scroll");{n&&(i=Math.min(Math.max(i,-80),80),v(S()+i),p(i),i<.25?(i+=.25,r=window.requestAnimationFrame(e)):.25<i?(i-=.25,r=window.requestAnimationFrame(e)):(i=0,cancelAnimationFrame(r)))}})}function m(e){e.preventDefault();var t=-1*e.deltaY;v(S()+t),p(t),console.log(n,t),Math.abs(n)<=Math.abs(t)&&!l?(l=!0,console.log("wheel retriggered")):(l=!1,console.log("wheel slowing down")),n=t,150<Math.abs(t)&&console.log("trigger custom animation now: "+t),cancelAnimationFrame(r),cancelAnimationFrame(o)}function p(e){var t=Math.abs(e),n=map(t=Math.min(Math.max(t,0),80),0,80,1,.1),i=map(t,20,80,0,1),a=document.querySelector(".static-anim"),r=document.querySelector(".infinite-scroll");a.style.opacity=i,r.style.opacity=n}function S(){var e,t=document.querySelector(".infinite-scroll"),n=window.getComputedStyle(t).getPropertyValue("transform");return"none"===n?(t.style.transform="translateY(0)",0):(e=n.match(/matrix.*\((.+)\)/)[1].split(", "),parseInt(e[5],10))}function v(e){document.querySelector(".infinite-scroll").style.transform="translateY("+e+"px)"}function M(){var e=0,t=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var i,a=Object.keys(_2.default);t.hasChildNodes()&&(e=(i=parseInt(t.lastChild.getAttribute("data-id"),10))===a.length-1?0:i+1);var r="Untitled_Artwork-"+(e+1).toString();n.innerHTML='<img src="'+_2.default[r].png+'">\n    <div>'+e+"</div>",n.setAttribute("data-id",e),t.appendChild(n)}Promise.all(e).then(function(e){d.innerHTML="";var t=Object.keys(_2.default),n=document.createElement("div");n.classList.add("static-anim"),d.appendChild(n);var i=document.createElement("img");i.src=_2.default[t[0]].png,i.setAttribute("data-id",0),n.appendChild(i);var a=document.createElement("div");a.classList.add("infinite-scroll"),d.appendChild(a);for(;a.scrollHeight<=window.innerHeight;)M();o=window.requestAnimationFrame(function e(){document.querySelector(".infinite-scroll")&&(v(S()+1),o=window.requestAnimationFrame(e))}),d.addEventListener("wheel",throttledEvent(m,5)),d.addEventListener("touchstart",c,!1),d.addEventListener("touchmove",throttledEvent(u,5),!1),d.addEventListener("touchend",f,!1),d.addEventListener("touchcancel",f,!1),new MutationObserver(function(e){var t=!0,n=!1,i=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){var o=a.value;if("attributes"===o.type&&"style"===o.attributeName){var l=document.querySelector(".infinite-scroll"),d=S(),s=l.firstChild,c=l.lastChild;Math.abs(d)>s.offsetHeight?(s.remove(),l.style.transform="translateY(0)"):l.offsetHeight-c.offsetHeight-Math.abs(d)>window.innerHeight&&c.remove(),0<d?function(){var e=0,t=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var i=Object.keys(_2.default),a=parseInt(t.firstChild.getAttribute("data-id"),10);e=0===a?i.length-1:a-1;var r="Untitled_Artwork-"+(e+1).toString();n.innerHTML='<img src="'+_2.default[r].png+'">\n  <div>'+e+"</div>",n.setAttribute("data-id",e),t.prepend(n),t.style.transform="translateY("+-n.offsetHeight+"px)"}():window.innerHeight+Math.abs(d)>l.offsetHeight&&M();var u,f,m,p=document.getElementsByClassName("infinite-scroll__item"),v=document.querySelector(".static-anim"),h=v.getBoundingClientRect(),g=void 0,y=9999,_=!0,w=!1,b=void 0;try{for(var E,L=p[Symbol.iterator]();!(_=(E=L.next()).done);_=!0){var C=E.value,q=C.getBoundingClientRect(),A=Math.abs(q.top-h.top);A<y&&(y=A,g=C)}}catch(e){w=!0,b=e}finally{try{_||null==L.return||L.return()}finally{if(w)throw b}}g.getBoundingClientRect().top<=h.top&&(u=Object.keys(_2.default),f=v.querySelector("img"),m=g.getAttribute("data-id"),f.src=_2.default[u[m]].png,f.setAttribute("data-id",m))}}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}).observe(a,{attributes:!0})}).catch(function(e){return console.error(e)})}function throttledEvent(t,n){var i;return function(e){i||(t(e),i=setTimeout(function(){i=null},n))}}function map(e,t,n,i,a){return(e-t)*(a-i)/(n-t)+i}function loadImage(i){return new Promise(function(e,t){var n=new Image;n.addEventListener("load",function(){return e(n)}),n.addEventListener("error",t),n.src=i})}initApp();