"use strict";require("./fonts.less"),require("./styles.less");var _=_interopRequireDefault(require("./media/*/*.*")),_2=_interopRequireDefault(require("./animation/*.*")),_contentInfo=_interopRequireDefault(require("./content-info.md"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var pages={home:{title:"Animotor",slug:"/",loadContents:function(){loadHome()}},work:{title:"Work",slug:"/work",loadContents:function(){loadWork()}},info:{title:"Info",slug:"/info",loadContents:function(){loadInfo()}}},defaultPage=pages.home;function initApp(){buildNavigation(),navigateToCurrentURL(),window.addEventListener("popstate",function(e){buildPage({slug:e.state.slug},!1)})}function navigateToCurrentURL(){var e=window.location.pathname,t=defaultPage;for(var n in pages)pages[n].slug===e&&(t=pages[n]);buildPage({slug:t.slug},!0)}function buildNavigation(){var e=document.getElementById("app"),t=document.createElement("nav");t.id="nav",e.appendChild(t);var n=document.createElement("ul");for(var a in t.appendChild(n),pages){var i=document.createElement("li"),r=document.createElement("a");r.href=pages[a].slug,r.setAttribute("data-link",""),r.innerHTML=pages[a].title,i.appendChild(r),n.appendChild(i),r.addEventListener("click",handlePageLink)}}function buildPage(e,t){var n,a=document.getElementById("main");for(var i in a?a.innerHTML="":((a=document.createElement("main")).id="main",app.appendChild(a)),pages)pages[i].slug===e.slug&&(n=pages[i]);var r="Animotor";n!==defaultPage&&(r+=" - "+n.title),document.title=r,t&&window.history.pushState(e,n.title,n.slug),updateNavigation(n.slug),n.loadContents()}function updateNavigation(e){var t=document.querySelectorAll("nav a"),n=!0,a=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){r.value.removeAttribute("data-active")}}catch(e){a=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}document.querySelector('a[href="'+e+'"]').setAttribute("data-active","")}function handlePageLink(e){e.preventDefault(),buildPage({slug:e.target.getAttribute("href")},!0)}function loadInfo(){document.getElementById("main").innerHTML='<article class="info">'+_contentInfo.default+"</article>"}function loadWork(){function e(e){var t=1<Object.keys(_.default[e]).length,n=document.createElement("div");n.classList.add("slideshow"),p.appendChild(n);var a=document.createElement("div");a.classList.add("slideshow__slides-wrapper"),n.appendChild(a);var i=void 0;a.addEventListener("scroll",function(t){window.clearTimeout(i),i=setTimeout(function(){var e=Math.round(t.target.scrollLeft/t.target.offsetWidth);!function(e){var t=e.parentNode,n=!0,a=!1,i=void 0;try{for(var r,o=t.children[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){r.value.removeAttribute("data-active")}}catch(e){a=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}e.setAttribute("data-active","")}(t.target.closest(".slideshow").querySelector(".slideshow__indicators-wrapper").children[e])},10)},!1);var r,o,l,d=void 0;for(var s in t&&((r=document.createElement("div")).classList.add("slideshow__nav"),n.appendChild(r),(o=document.createElement("button")).classList.add("slideshow__nav__btn"),r.appendChild(o),o.addEventListener("click",g),(l=document.createElement("button")).classList.add("slideshow__nav__btn"),r.appendChild(l),l.addEventListener("click",w),(d=document.createElement("div")).classList.add("slideshow__indicators-wrapper"),n.appendChild(d)),_.default[e])for(var c in _.default[e][s]){var u,f,m=_.default[e][s][c],v=document.createElement("div");v.classList.add("slideshow__slide"),a.appendChild(v),"jpg"!==c&&"png"!==c&&"gif"!==c||((u=document.createElement("img")).src=m,u.classList.add("slideshow__slide__media"),v.appendChild(u)),t&&((f=document.createElement("div")).classList.add("slideshow__indicator"),f.addEventListener("click",h),d.appendChild(f))}t&&d.querySelector(".slideshow__indicator").setAttribute("data-active","")}var p=document.getElementById("main");for(var t in _.default)e(t);function h(e){var t=e.target,n=t.closest(".slideshow__indicators-wrapper"),a=t.closest(".slideshow"),i=a.querySelector(".slideshow__slides-wrapper"),r=Array.from(n.children).indexOf(t);i.scrollTo({left:r*a.offsetWidth,behavior:"smooth"})}function g(e){var t=e.target.closest(".slideshow__slides-wrapper");t.scrollTo({left:t.scrollLeft-t.offsetWidth,behavior:"smooth"})}function w(e){var t=e.target.closest(".slideshow__slides-wrapper");t.scrollTo({left:t.scrollLeft+t.offsetWidth,behavior:"smooth"})}}function loadHome(){var a,i,r,o,l=document.createElement("div");l.classList.add("infinite-scroll-container"),l.innerHTML="loading",main.appendChild(l);var e=[];for(var t in _2.default)for(var n in _2.default[t])e.push(loadImage(_2.default[t][n]));function d(e){e.preventDefault();var t=e.changedTouches;a=t[0].pageY,cancelAnimationFrame(r),cancelAnimationFrame(o)}function s(e){e.preventDefault(),i=a;var t=e.changedTouches,n=-1*(a-t[0].pageY);a=t[0].pageY,m(S()+n),f(n)}function c(e){e.preventDefault();var t=e.changedTouches,a=-1*(i-t[0].pageY);r=window.requestAnimationFrame(function e(t){var n=!!document.querySelector(".infinite-scroll");{n&&(a=Math.min(Math.max(a,-80),80),m(S()+a),f(a),a<.25?(a+=.25,r=window.requestAnimationFrame(e)):.25<a?(a-=.25,r=window.requestAnimationFrame(e)):(a=0,cancelAnimationFrame(r)))}})}function u(e){e.preventDefault();var t=-1*e.deltaY;m(S()+t),f(t),cancelAnimationFrame(r),cancelAnimationFrame(o)}function f(e){var t=Math.abs(e),n=map(t=Math.min(Math.max(t,0),80),0,80,1,.1),a=map(t,20,80,0,1),i=document.querySelector(".static-anim"),r=document.querySelector(".infinite-scroll");i.style.opacity=a,r.style.opacity=n}function S(){var e,t=document.querySelector(".infinite-scroll"),n=window.getComputedStyle(t).getPropertyValue("transform");return"none"===n?(t.style.transform="translateY(0)",0):(e=n.match(/matrix.*\((.+)\)/)[1].split(", "),parseInt(e[5],10))}function m(e){document.querySelector(".infinite-scroll").style.transform="translateY("+e+"px)"}function k(){var e=0,t=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var a,i=Object.keys(_2.default);t.hasChildNodes()&&(e=(a=parseInt(t.lastChild.getAttribute("data-id"),10))===i.length-1?0:a+1);var r="Untitled_Artwork-"+(e+1).toString();n.innerHTML='<img src="'+_2.default[r].png+'">\n    <div>'+e+"</div>",n.setAttribute("data-id",e),t.appendChild(n)}Promise.all(e).then(function(e){l.innerHTML="";var t=Object.keys(_2.default),n=document.createElement("div");n.classList.add("static-anim"),l.appendChild(n);var a=document.createElement("img");a.src=_2.default[t[0]].png,a.setAttribute("data-id",0),n.appendChild(a);var i=document.createElement("div");i.classList.add("infinite-scroll"),l.appendChild(i);for(;i.scrollHeight<=window.innerHeight;)k();o=window.requestAnimationFrame(function e(){m(S()+1),o=window.requestAnimationFrame(e)}),l.addEventListener("wheel",throttledEvent(u,5)),l.addEventListener("touchstart",d,!1),l.addEventListener("touchmove",throttledEvent(s,5),!1),l.addEventListener("touchend",c,!1),l.addEventListener("touchcancel",c,!1),new MutationObserver(function(e){var t=!0,n=!1,a=void 0;try{for(var i,r=e[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;if("attributes"===o.type&&"style"===o.attributeName){var l=document.querySelector(".infinite-scroll"),d=S(),s=l.firstChild,c=l.lastChild;Math.abs(d)>s.offsetHeight?(s.remove(),l.style.transform="translateY(0)"):l.offsetHeight-c.offsetHeight-Math.abs(d)>window.innerHeight&&c.remove(),0<d?function(){var e=0,t=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var a=Object.keys(_2.default),i=parseInt(t.firstChild.getAttribute("data-id"),10);e=0===i?a.length-1:i-1;var r="Untitled_Artwork-"+(e+1).toString();n.innerHTML='<img src="'+_2.default[r].png+'">\n  <div>'+e+"</div>",n.setAttribute("data-id",e),t.prepend(n),t.style.transform="translateY("+-n.offsetHeight+"px)"}():window.innerHeight+Math.abs(d)>l.offsetHeight&&k();var u,f,m,v=document.getElementsByClassName("infinite-scroll__item"),p=document.querySelector(".static-anim"),h=p.getBoundingClientRect(),g=void 0,_=9999,w=!0,y=!1,b=void 0;try{for(var E,L=v[Symbol.iterator]();!(w=(E=L.next()).done);w=!0){var C=E.value,A=C.getBoundingClientRect(),q=Math.abs(A.top-h.top);q<_&&(_=q,g=C)}}catch(e){y=!0,b=e}finally{try{w||null==L.return||L.return()}finally{if(y)throw b}}g.getBoundingClientRect().top<=h.top&&(u=Object.keys(_2.default),f=p.querySelector("img"),m=g.getAttribute("data-id"),f.src=_2.default[u[m]].png,f.setAttribute("data-id",m))}}}catch(e){n=!0,a=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw a}}}).observe(i,{attributes:!0})}).catch(function(e){return console.error(e)})}function throttledEvent(t,n){var a;return function(e){a||(t(e),a=setTimeout(function(){a=null},n))}}function map(e,t,n,a,i){return(e-t)*(i-a)/(n-t)+a}function loadImage(a){return new Promise(function(e,t){var n=new Image;n.addEventListener("load",function(){return e(n)}),n.addEventListener("error",t),n.src=a})}initApp();