"use strict";require("./fonts.less"),require("./styles.less");var _projects=_interopRequireDefault(require("./projects.json")),_=_interopRequireDefault(require("./media/*.*")),_2=_interopRequireDefault(require("./animation/*.*")),_contentInfo=_interopRequireDefault(require("./content-info.md"));function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var defaultRoute="/",pages={home:{title:"Home",slug:"/",loadContents:function(){loadHome()}},work:{title:"Work",slug:"/work",loadContents:function(){loadWork()}},info:{title:"Info",slug:"/info",loadContents:function(){loadInfo()}}};function initApp(){navigateToCurrentURL();var t=document.querySelectorAll("a[data-link]"),e=!0,n=!1,r=void 0;try{for(var a,i=t[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){a.value.addEventListener("click",handlePageLink)}}catch(t){n=!0,r=t}finally{try{e||null==i.return||i.return()}finally{if(n)throw r}}}function handlePageLink(t){t.preventDefault(),buildPage({slug:t.target.getAttribute("href")})}function navigateToCurrentURL(){var t=window.location.pathname,e=defaultRoute;for(var n in pages)pages[n].slug===t&&(e=pages[n].slug);buildPage({slug:e})}function buildPage(t){var e,n=document.getElementById("main");for(var r in n.innerHTML="",pages)pages[r].slug===t.slug&&(e=pages[r]);window.history.pushState(t,"",e.slug);var a=document.querySelectorAll("a[data-link]"),i=!0,o=!1,l=void 0;try{for(var u,d=a[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){u.value.removeAttribute("data-active")}}catch(t){o=!0,l=t}finally{try{i||null==d.return||d.return()}finally{if(o)throw l}}document.querySelector('a[href="'+e.slug+'"]').setAttribute("data-active",""),e.loadContents()}function loadInfo(){main.innerHTML='<article class="info">'+_contentInfo.default+"</article>"}function loadWork(){console.log("load work")}function loadHome(){var t=document.createElement("div");t.classList.add("infinite-scroll-container"),main.appendChild(t);var L=Object.keys(_2.default),e=document.createElement("div");e.classList.add("static-anim"),t.appendChild(e);var n=document.createElement("img");n.src=_2.default[L[0]].png,n.setAttribute("data-id",0),e.appendChild(n);var r=document.createElement("div");for(r.classList.add("infinite-scroll"),t.appendChild(r);r.scrollHeight<=window.innerHeight;)k();t.addEventListener("wheel",throttledEvent(function(t){t.preventDefault();var e=-1*t.deltaY;d(E()+e),u(e)},5)),t.addEventListener("touchstart",function(t){t.preventDefault();var e=t.changedTouches;a=e[0].pageY,cancelAnimationFrame(o)},!1),t.addEventListener("touchmove",throttledEvent(function(t){t.preventDefault(),i=a;var e=t.changedTouches,n=-1*(a-e[0].pageY);a=e[0].pageY,d(E()+n),u(n)},5),!1),t.addEventListener("touchend",l,!1),t.addEventListener("touchcancel",l,!1);var a,i,o;new MutationObserver(function(t){var e=!0,n=!1,r=void 0;try{for(var a,i=t[Symbol.iterator]();!(e=(a=i.next()).done);e=!0){var o=a.value;if("attributes"===o.type&&"style"===o.attributeName){var l=document.querySelector(".infinite-scroll"),u=E(),d=l.firstChild,s=l.lastChild;Math.abs(u)>d.offsetHeight?(d.remove(),l.style.transform="translateY(0)"):l.offsetHeight-s.offsetHeight-Math.abs(u)>window.innerHeight&&s.remove(),0<u?function(){var t=0,e=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var r=Object.keys(_2.default),a=parseInt(e.firstChild.getAttribute("data-id"),10);t=0===a?r.length-1:a-1;var i="Untitled_Artwork-"+(t+1).toString();n.innerHTML='<img src="'+_2.default[i].png+'">\n  <div>'+t+"</div>",n.setAttribute("data-id",t),e.prepend(n),e.style.transform="translateY("+-n.offsetHeight+"px)"}():window.innerHeight+Math.abs(u)>l.offsetHeight&&k();var c,f,m=document.getElementsByClassName("infinite-scroll__item"),v=document.querySelector(".static-anim"),g=v.getBoundingClientRect(),p=void 0,h=9999,y=!0,b=!1,_=void 0;try{for(var q,w=m[Symbol.iterator]();!(y=(q=w.next()).done);y=!0){var C=q.value,S=C.getBoundingClientRect(),A=Math.abs(S.top-g.top);A<h&&(h=A,p=C)}}catch(t){b=!0,_=t}finally{try{y||null==w.return||w.return()}finally{if(b)throw _}}p.getBoundingClientRect().top<=g.top&&(c=v.querySelector("img"),f=p.getAttribute("data-id"),c.src=_2.default[L[f]].png,c.setAttribute("data-id",f))}}}catch(t){n=!0,r=t}finally{try{e||null==i.return||i.return()}finally{if(n)throw r}}}).observe(r,{attributes:!0});function l(t){t.preventDefault();var e=t.changedTouches,r=-1*(i-e[0].pageY);o=requestAnimationFrame(function t(e){r=Math.min(Math.max(r,-80),80);var n=E()+r;d(n);u(r);{(0<r||r<0)&&(o=window.requestAnimationFrame(t),0<r?r-=.25:r<0&&(r+=.25))}})}function u(t){var e=Math.abs(t),n=map(e=Math.min(Math.max(e,0),80),0,80,1,.1),r=map(e,20,80,0,1),a=document.querySelector(".static-anim"),i=document.querySelector(".infinite-scroll");a.style.opacity=r,i.style.opacity=n}function E(){var t,e=document.querySelector(".infinite-scroll"),n=window.getComputedStyle(e).getPropertyValue("transform");return"none"===n?(e.style.transform="translateY(0)",0):(t=n.match(/matrix.*\((.+)\)/)[1].split(", "),parseInt(t[5],10))}function d(t){document.querySelector(".infinite-scroll").style.transform="translateY("+t+"px)"}function k(){var t=0,e=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var r,a=Object.keys(_2.default);e.hasChildNodes()&&(t=(r=parseInt(e.lastChild.getAttribute("data-id"),10))===a.length-1?0:r+1);var i="Untitled_Artwork-"+(t+1).toString();n.innerHTML='<img src="'+_2.default[i].png+'">\n    <div>'+t+"</div>",n.setAttribute("data-id",t),e.appendChild(n)}}function throttledEvent(e,n){var r;return function(t){r||(e(t),r=setTimeout(function(){r=null},n))}}function map(t,e,n,r,a){return(t-e)*(a-r)/(n-e)+r}initApp();