"use strict";require("./fonts.less"),require("./styles.less");var _=_interopRequireDefault(require("./media/*/*.*")),_2=_interopRequireDefault(require("./animation/*.*")),_contentInfo=_interopRequireDefault(require("./content-info.md"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var pages={home:{title:"Animotor",slug:"/",loadContents:function(){loadHome()}},work:{title:"Work",slug:"/work",loadContents:function(){loadWork()}},info:{title:"Info",slug:"/info",loadContents:function(){loadInfo()}}},defaultPage=pages.home;function initApp(){buildNavigation(),navigateToCurrentURL(),window.addEventListener("popstate",function(e){buildPage({slug:e.state.slug},!1)})}function navigateToCurrentURL(){var e=window.location.pathname,t=defaultPage;for(var n in pages)pages[n].slug===e&&(t=pages[n]);buildPage({slug:t.slug},!0)}function buildNavigation(){var e=document.getElementById("app"),t=document.createElement("nav");t.id="nav",e.appendChild(t);var n=document.createElement("ul");for(var a in t.appendChild(n),pages){var i=document.createElement("li"),r=document.createElement("a");r.href=pages[a].slug,r.setAttribute("data-link",""),r.innerHTML=pages[a].title,i.appendChild(r),n.appendChild(i),r.addEventListener("click",handlePageLink)}}function buildPage(e,t){var n,a=document.getElementById("main");for(var i in a?a.innerHTML="":((a=document.createElement("main")).id="main",app.appendChild(a)),pages)pages[i].slug===e.slug&&(n=pages[i]);var r="Animotor";n!==defaultPage&&(r+=" - "+n.title),document.title=r,t&&window.history.pushState(e,n.title,n.slug),updateNavigation(n.slug),n.loadContents()}function updateNavigation(e){var t=document.querySelectorAll("nav a"),n=!0,a=!1,i=void 0;try{for(var r,o=t[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){r.value.removeAttribute("data-active")}}catch(e){a=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}document.querySelector('a[href="'+e+'"]').setAttribute("data-active","")}function handlePageLink(e){e.preventDefault(),buildPage({slug:e.target.getAttribute("href")},!0)}function loadInfo(){document.getElementById("main").innerHTML='<article class="info">'+_contentInfo.default+"</article>"}function loadWork(){var e=document.getElementById("main");for(var t in _.default){var n=document.createElement("div");n.classList.add("slideshow"),e.appendChild(n);var a=document.createElement("div");a.classList.add("slideshow__nav"),n.appendChild(a);var i=document.createElement("button");i.classList.add("slideshow__nav__button"),a.appendChild(i),i.addEventListener("click",v);var r=document.createElement("button");r.classList.add("slideshow__nav__button"),a.appendChild(r),r.addEventListener("click",p);var o=document.createElement("div");for(var l in o.classList.add("slideshow__indicator"),n.appendChild(o),_.default[t])for(var d in _.default[t][l]){var s=_.default[t][l][d],u=document.createElement("div");u.classList.add("slideshow__item"),n.appendChild(u);var c,f=document.createElement("div");f.classList.add("slideshow__indicator__item"),o.appendChild(f),o.addEventListener("click",m),"jpg"!==d&&"png"!==d||((c=document.createElement("img")).src=s,c.classList.add("project__item__media"),u.appendChild(c))}o.querySelector(".slideshow__indicator__item").setAttribute("data-active","")}function m(e){var t=e.target.closest(".slideshow__indicator"),n=!0,a=!1,i=void 0;try{for(var r,o=t.children[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){r.value.removeAttribute("data-active")}}catch(e){a=!0,i=e}finally{try{n||null==o.return||o.return()}finally{if(a)throw i}}e.target.setAttribute("data-active","")}function v(e){var t=e.target.closest(".slideshow");t.scrollTo({left:t.scrollLeft-t.offsetWidth,behavior:"smooth"})}function p(e){var t=e.target.closest(".slideshow");t.scrollTo({left:t.scrollLeft+t.offsetWidth,behavior:"smooth"})}}function loadHome(){var e=document.createElement("div");e.classList.add("infinite-scroll-container"),main.appendChild(e);var q=Object.keys(_2.default),t=document.createElement("div");t.classList.add("static-anim"),e.appendChild(t);var n=document.createElement("img");n.src=_2.default[q[0]].png,n.setAttribute("data-id",0),t.appendChild(n);var a=document.createElement("div");for(a.classList.add("infinite-scroll"),e.appendChild(a);a.scrollHeight<=window.innerHeight;)k();e.addEventListener("wheel",throttledEvent(function(e){e.preventDefault();var t=-1*e.deltaY;s(S()+t),d(t)},5)),e.addEventListener("touchstart",function(e){e.preventDefault();var t=e.changedTouches;i=t[0].pageY,cancelAnimationFrame(o)},!1),e.addEventListener("touchmove",throttledEvent(function(e){e.preventDefault(),r=i;var t=e.changedTouches,n=-1*(i-t[0].pageY);i=t[0].pageY,s(S()+n),d(n)},5),!1),e.addEventListener("touchend",l,!1),e.addEventListener("touchcancel",l,!1);var i,r,o;new MutationObserver(function(e){var t=!0,n=!1,a=void 0;try{for(var i,r=e[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;if("attributes"===o.type&&"style"===o.attributeName){var l=document.querySelector(".infinite-scroll"),d=S(),s=l.firstChild,u=l.lastChild;Math.abs(d)>s.offsetHeight?(s.remove(),l.style.transform="translateY(0)"):l.offsetHeight-u.offsetHeight-Math.abs(d)>window.innerHeight&&u.remove(),0<d?function(){var e=0,t=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var a=Object.keys(_2.default),i=parseInt(t.firstChild.getAttribute("data-id"),10);e=0===i?a.length-1:i-1;var r="Untitled_Artwork-"+(e+1).toString();n.innerHTML='<img src="'+_2.default[r].png+'">\n  <div>'+e+"</div>",n.setAttribute("data-id",e),t.prepend(n),t.style.transform="translateY("+-n.offsetHeight+"px)"}():window.innerHeight+Math.abs(d)>l.offsetHeight&&k();var c,f,m=document.getElementsByClassName("infinite-scroll__item"),v=document.querySelector(".static-anim"),p=v.getBoundingClientRect(),h=void 0,g=9999,_=!0,y=!1,b=void 0;try{for(var w,E=m[Symbol.iterator]();!(_=(w=E.next()).done);_=!0){var C=w.value,L=C.getBoundingClientRect(),A=Math.abs(L.top-p.top);A<g&&(g=A,h=C)}}catch(e){y=!0,b=e}finally{try{_||null==E.return||E.return()}finally{if(y)throw b}}h.getBoundingClientRect().top<=p.top&&(c=v.querySelector("img"),f=h.getAttribute("data-id"),c.src=_2.default[q[f]].png,c.setAttribute("data-id",f))}}}catch(e){n=!0,a=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw a}}}).observe(a,{attributes:!0});function l(e){e.preventDefault();var t=e.changedTouches,a=-1*(r-t[0].pageY);o=requestAnimationFrame(function e(t){a=Math.min(Math.max(a,-80),80);var n=S()+a;s(n);d(a);{(0<a||a<0)&&(o=window.requestAnimationFrame(e),0<a?a-=.25:a<0&&(a+=.25))}})}function d(e){var t=Math.abs(e),n=map(t=Math.min(Math.max(t,0),80),0,80,1,.1),a=map(t,20,80,0,1),i=document.querySelector(".static-anim"),r=document.querySelector(".infinite-scroll");i.style.opacity=a,r.style.opacity=n}function S(){var e,t=document.querySelector(".infinite-scroll"),n=window.getComputedStyle(t).getPropertyValue("transform");return"none"===n?(t.style.transform="translateY(0)",0):(e=n.match(/matrix.*\((.+)\)/)[1].split(", "),parseInt(e[5],10))}function s(e){document.querySelector(".infinite-scroll").style.transform="translateY("+e+"px)"}function k(){var e=0,t=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var a,i=Object.keys(_2.default);t.hasChildNodes()&&(e=(a=parseInt(t.lastChild.getAttribute("data-id"),10))===i.length-1?0:a+1);var r="Untitled_Artwork-"+(e+1).toString();n.innerHTML='<img src="'+_2.default[r].png+'">\n    <div>'+e+"</div>",n.setAttribute("data-id",e),t.appendChild(n)}}function throttledEvent(t,n){var a;return function(e){a||(t(e),a=setTimeout(function(){a=null},n))}}function map(e,t,n,a,i){return(e-t)*(i-a)/(n-t)+a}initApp();