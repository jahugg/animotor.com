"use strict";require("./fonts.less"),require("./styles.less");var _projects=_interopRequireDefault(require("./projects.json")),_=_interopRequireDefault(require("./media/*.*")),_2=_interopRequireDefault(require("./animation/*.*")),_contentInfo=_interopRequireDefault(require("./content-info.md"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var defaultRoute="/",pages=[{title:"home",route:"/",content:"loadProjects()"},{title:"about",route:"/about",content:"content-info.md"}];function initApp(){navigateToCurrentURL();var e=document.querySelectorAll('a[data-link="page"]'),t=!0,n=!1,r=void 0;try{for(var a,i=e[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){a.value.addEventListener("click",handlePageLink)}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}function handlePageLink(e){e.preventDefault(),buildPage({route:e.target.getAttribute("href")})}function navigateToCurrentURL(){for(var e=window.location.pathname,t=[],n=0,r=pages;n<r.length;n++){var a=r[n];t.push(a.route)}var i=defaultRoute;t.includes(e)&&(i=e),buildPage({route:i})}function buildPage(e){var t,n=document.getElementById("main"),r=!(n.innerHTML=""),a=!1,i=void 0;try{for(var o,l=pages[Symbol.iterator]();!(r=(o=l.next()).done);r=!0){var u=o.value;u.route==e.route&&(t=u)}}catch(e){a=!0,i=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw i}}if(window.history.pushState(e,"",t.route),"home"===t.title)loadHome();else if("about"===t.title){var d=document.querySelector("#nav a");d.href="/",d.innerHTML="work",n.innerHTML='<article class="about">'+_contentInfo.default+"</article>"}}function loadHome(){var e=document.querySelector("#nav a");e.href="/about",e.innerHTML="about";var E=Object.keys(_2.default),t=document.createElement("div");t.classList.add("static-anim"),main.appendChild(t);var n=document.createElement("img");n.src=_2.default[E[0]].png,n.setAttribute("data-id",0),t.appendChild(n);var r=document.createElement("div");r.classList.add("infinite-scroll-container"),main.appendChild(r);var a=document.createElement("div");for(a.classList.add("infinite-scroll"),r.appendChild(a);a.scrollHeight<=window.innerHeight;)M();r.addEventListener("wheel",throttledEvent(function(e){e.preventDefault();var t=-1*e.deltaY;c(H()+t),d(t)},5)),r.addEventListener("touchstart",function(e){e.preventDefault();var t=e.changedTouches;i=t[0].pageY,cancelAnimationFrame(l)},!1),r.addEventListener("touchmove",throttledEvent(function(e){e.preventDefault(),o=i;var t=e.changedTouches,n=-1*(i-t[0].pageY);i=t[0].pageY,c(H()+n),d(n)},5),!1),r.addEventListener("touchend",u,!1),r.addEventListener("touchcancel",u,!1);var i,o,l;new MutationObserver(function(e){var t=!0,n=!1,r=void 0;try{for(var a,i=e[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var o=a.value;if("attributes"===o.type&&"style"===o.attributeName){var l=document.querySelector(".infinite-scroll"),u=H(),d=l.firstChild,c=l.lastChild;Math.abs(u)>d.offsetHeight?(d.remove(),l.style.transform="translateY(0)"):l.offsetHeight-c.offsetHeight-Math.abs(u)>window.innerHeight&&c.remove(),0<u?A():window.innerHeight+Math.abs(u)>l.offsetHeight&&M();var s=document.getElementsByClassName("infinite-scroll__item"),f=document.querySelector(".static-anim"),m=f.getBoundingClientRect(),v=void 0,h=9999,p=!0,g=!1,y=void 0;try{for(var b,q=s[Symbol.iterator]();!(p=(b=q.next()).done);p=!0){var _=b.value,w=_.getBoundingClientRect(),L=Math.abs(w.top-m.top);L<h&&(h=L,v=_)}}catch(e){g=!0,y=e}finally{try{p||null==q.return||q.return()}finally{if(g)throw y}}if(v.getBoundingClientRect().top<=m.top){var S=f.querySelector("img"),C=v.getAttribute("data-id");S.src=_2.default[E[C]].png,S.setAttribute("data-id",C)}}}}catch(e){n=!0,r=e}finally{try{t||null==i.return||i.return()}finally{if(n)throw r}}}).observe(a,{attributes:!0});function u(e){e.preventDefault();var t=e.changedTouches,r=-1*(o-t[0].pageY);l=requestAnimationFrame(function e(t){r=Math.min(Math.max(r,-80),80);var n=H()+r;c(n);d(r);(0<r||r<0)&&(l=window.requestAnimationFrame(e),0<r?r--:r<0&&r++)})}function d(e){var t=Math.abs(e),n=map(t=Math.min(Math.max(t,0),100),0,100,1,0),r=map(t,0,100,0,1),a=document.querySelector(".static-anim"),i=document.querySelector(".infinite-scroll");a.style.opacity=r,i.style.opacity=n}function H(){var e,t=document.querySelector(".infinite-scroll"),n=window.getComputedStyle(t).getPropertyValue("transform");if("none"===n)t.style.transform="translateY(0)",e=0;else{var r=n.match(/matrix.*\((.+)\)/)[1].split(", ");e=parseInt(r[5],10)}return e}function c(e){document.querySelector(".infinite-scroll").style.transform="translateY("+e+"px)"}function M(){var e=0,t=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var r=Object.keys(_2.default);if(t.hasChildNodes()){var a=parseInt(t.lastChild.getAttribute("data-id"),10);e=a===r.length-1?0:a+1}n.innerHTML='<img src="'+_2.default[r[e]].png+'">\n    <div>'+e+"</div>",n.setAttribute("data-id",e),t.appendChild(n)}function A(){var e=0,t=document.querySelector(".infinite-scroll"),n=document.createElement("div");n.classList.add("infinite-scroll__item");var r=Object.keys(_2.default),a=parseInt(t.firstChild.getAttribute("data-id"),10);e=0===a?r.length-1:a-1,n.innerHTML='<img src="'+_2.default[r[e]].png+'">\n  <div>'+e+"</div>",n.setAttribute("data-id",e),t.prepend(n),t.style.transform="translateY("+-n.offsetHeight+"px)"}}function throttledEvent(t,n){var r;return function(e){r||(t(e),r=setTimeout(function(){r=null},n))}}function map(e,t,n,r,a){return(e-t)*(a-r)/(n-t)+r}initApp();